

zainab@beagle:~/dev/zainab/blog/ > cd ../../zainab-ali/functio
nal-stream-processing-workshop
zainab@beagle:~/dev/zainab-ali/functional-stream-processing-wo
rkshop/ > nix develop
warning: Git tree '/Users/zainab/dev/zainab-ali/functional-str
eam-processing-workshop' is dirty
λ> pwd
/Users/zainab/dev/zainab-ali/functional-stream-processing-work
shop
λ> scala-cli

^Cλ> scala-cli compile project.scala scala/Part1Introduction/C
ode1WhatAreStreams.sc
Compiling project (Scala 3.7.0, JVM (21))
Compiled project (Scala 3.7.0, JVM (21))
λ> scala-cli repl project.scala scala/Part1Introduction/Code1W
hatAreStreams.sc

Welcome to Scala 3.7.0 (21.0.4, Java OpenJDK 64-Bit Server VM)
.
Type in expressions for evaluation. Or try :help.


scala> def countNumbers(until: Int, predicate: Int => Boolean)
: Int = ???
def countNumbers(until: Int, predicate: Int => Boolean): Int

scala> countNumbers(4, true)
-- [E007] Type Mismatch Error: -------------------------------
------------------
1 |countNumbers(4, true)
  |                ^^^^
  |                Found:    (true : Boolean)
  |                Required: Int => Boolean
  |
  | longer explanation available when compiling with `-explain
`
1 error found

scala> countNumbers(4, _ % 2)
-- [E007] Type Mismatch Error: -------------------------------
------------------
1 |countNumbers(4, _ % 2)
  |                ^^^^^
  |                Found:    Int
  |                Required: Boolean
  |
  | longer explanation available when compiling with `-explain
`
1 error found


scala> def countNumbersList(until: Int, predicate: Int => Bool
ean): Int =
     |   List.range(0, until).filter(predicate).size
     |
def countNumbersList(until: Int, predicate: Int => Boolean): I
nt


scala> List.range(0, 4)
val res0: List[Int] = List(0, 1, 2, 3)


scala> List.range(0, 4).filter(_ % 2)
-- [E007] Type Mismatch Error: -------------------------------
------------------
1 |List.range(0, 4).filter(_ % 2)
  |                        ^^^^^
  |                        Found:    Int
  |                        Required: Boolean
  |
  | longer explanation available when compiling with `-explain
`
1 error found


scala> List.range(0, 4).filter(_ % 2 == 2)

val res1: List[Int] = List()


scala> List.range(0, 4).filter(_ % 2 == 0)

val res2: List[Int] = List(0, 2)


scala> List.range(0, 4).filter(_ % 2 == 0).size
val res3: Int = 2


scala> List.range(0, 100).filter(_ % 2 == 0).size

val res4: Int = 50


scala> countNumbersList(100, _ % 2 == 0)
val res5: Int = 50
                                scala> countNumbersList(Int.Ma
scala> countNumbersList(Int.MaxValue, _ % 2 == 0)
Exception in thread "RMI TCP Connection(idle)" java.lang.OutOf
MemoryError: Java heap space
        at java.rmi/sun.rmi.transport.tcp.TCPTransport.handleM
essages(TCPTransport.java:597)
        at java.rmi/sun.rmi.transport.tcp.TCPTransport$Connect
ionHandler.run0(TCPTransport.java:844)
        at java.rmi/sun.rmi.transport.tcp.TCPTransport$Connect
ionHandler.lambda$run$0(TCPTransport.java:721)
        at java.rmi/sun.rmi.transport.tcp.TCPTransport$Connect
ionHandler$$Lambda/0x000000011e6e4060.run(Unknown Source)
        at java.base/java.security.AccessController.executePri
vileged(AccessController.java:778)
        at java.base/java.security.AccessController.doPrivileg
ed(AccessController.java:400)
        at java.rmi/sun.rmi.transport.tcp.TCPTransport$Connect
ionHandler.run(TCPTransport.java:720)
        at java.base/java.util.concurrent.ThreadPoolExecutor.r
unWorker(ThreadPoolExecutor.java:1144)
        at java.base/java.util.concurrent.ThreadPoolExecutor$W
orker.run(ThreadPoolExecutor.java:642)
        at java.base/java.lang.Thread.runWith(Thread.java:1596
)
        at java.base/java.lang.Thread.run(Thread.java:1583)
java.lang.OutOfMemoryError: Java heap space
  at scala.collection.immutable.List.prependedAll(List.scala:1
56)
  at scala.collection.immutable.List$.from(List.scala:685)
  at scala.collection.immutable.List$.from(List.scala:682)
  at scala.collection.IterableFactory.range(Factory.scala:132)
  at scala.collection.IterableFactory.range$(Factory.scala:132
)
  at scala.collection.immutable.List$.range(List.scala:682)
  at rs$line$2$.countNumbersList(rs$line$2:2)
  ... 25 elided


scala>

scala> def countNumbersLoop(until: Int, predicate: Int => Bool
ean): Int = {
     |   var count: Int = 0
     |   var i: Int = 0
     |   while (i < until) {
     |     if (predicate(i)) count = count + 1
     |     i = i + 1
     |   }
     |   count
     | }
     |
     |
def countNumbersLoop(until: Int, predicate: Int => Boolean): I
nt

scala> countNumbersLoop(4, _ % 2 == 0)
val res7: Int = 2

scala> countNumbersLoop(Int.MaxValue, _ => true)
val res8: Int = 2147483647

scala> countNumbersLoop(Int.MaxValue, _ => true)
val res9: Int = 2147483647

scala> def countNumbersRec(until: Int, predicate: Int => Boole
an): Int =
     | ???
def countNumbersRec(until: Int, predicate: Int => Boolean): In
t

scala>
     | /* Explicit recursion is also not composable */
     | def countNumbersRec(until: Int, predicate: Int => Boole
an): Int = {
     |   @scala.annotation.tailrec
     |   def go(count: Int, i: Int): Int = {
     |     if (i < until) {
     |       if (predicate(i)) {
     |         go(count + 1, i + 1)
     |       } else {
     |         go(count, i + 1)
     |       }
     |     } else {
     |       count
     |     }
     |   }
     |   go(0, 0)
     | }
def countNumbersRec(until: Int, predicate: Int => Boolean): In
t

scala> countNumbersRec(Int.MaxValue, _ => true)
val res10: Int = 2147483647

scala> countNumbersRec(Int.MaxValue, _ => true)
val res11: Int = 2147483647

scala> def countNumbersRec(until: Int, predicate: Int => Boole
an): Int = {
     |   // @scala.annotation.tailrec
     |   def go(count: Int, i: Int): Int = {
     |     if (i < until) {
     |       if (predicate(i)) {
     |         go(count + 1, i + 1)
     |       } else {
     |         go(count, i + 1)
     |       }
     |     } else {
     |       count
     |     }
     |   }
     |   go(0, 0)
     | }
     |
     |
def countNumbersRec(until: Int, predicate: Int => Boolean): In
t

scala> countNumbersRec(Int.MaxValue, _ => true)
val res12: Int = 2147483647

scala> import fs2.*

scala> def countNumbersStream(until: Int, predicate: Int => Bo
olean): Long =
     |   Stream.range(0, until).filter(predicate).compile.coun
t.toInt
     |
def countNumbersStream(until: Int, predicate: Int => Boolean):
 Long

scala> def countNumbersStream(until: Int, predicate: Int => Bo
olean): Long =
     |   Stream.range(0, until).filter(predicate).compile.coun
t
     |
def countNumbersStream(until: Int, predicate: Int => Boolean):
 Long


scala> countNumbersStream(4, _ % 2 == 0)
val res13: Long = 2


scala> countNumbersStream(Int.MaxValue, _ % 2 == 0)


^C
λ> scala-cli repl project.scala scala/Part1Introduction/Code1W
hatAreStreams.sc
Compiling project (Scala 3.7.0, JVM (21))
Compiled project (Scala 3.7.0, JVM (21))
Welcome to Scala 3.7.0 (21.0.4, Java OpenJDK 64-Bit Server VM)
.
Type in expressions for evaluation. Or try :help.

scala> import fs2.*

scala> val numbersList = List.range(0, Int.MaxValue)
java.lang.OutOfMemoryError: Java heap space
  at scala.collection.immutable.List.prependedAll(List.scala:1
56)
  at scala.collection.immutable.List$.from(List.scala:685)
  at scala.collection.immutable.List$.from(List.scala:682)
  at scala.collection.IterableFactory.range(Factory.scala:132)
  at scala.collection.IterableFactory.range$(Factory.scala:132
)
  at scala.collection.immutable.List$.range(List.scala:682)
  ... 26 elided

scala> val numbers = Stream.range(0, Int.MaxValue)
     |
val numbers: fs2.Stream[[x] =>> fs2.Pure[x], Int] = Stream(..)

scala> Stream.emits(List(0, 1, 2, 3))
val res0: fs2.Stream[[x] =>> fs2.Pure[x], Int] = Stream(..)

scala> res0.compile.count
val res1: Long = 4

scala> res0.compile.toList
val res2: List[Int] = List(0, 1, 2, 3)

scala>   Stream.emits(List.range(0, Int.MaxValue))
Exception in thread "RMI TCP Connection(idle)" java.lang.OutOf
MemoryError: Java heap space
        at java.base/java.nio.DirectByteBuffer.<init>(DirectBy
teBuffer.java:128)
        at java.base/java.nio.ByteBuffer.allocateDirect(ByteBu
ffer.java:360)
        at java.base/sun.nio.ch.Util.getTemporaryDirectBuffer(
Util.java:242)
        at java.base/sun.nio.ch.NioSocketImpl.tryRead(NioSocke
tImpl.java:253)
        at java.base/sun.nio.ch.NioSocketImpl.timedRead(NioSoc
ketImpl.java:274)
        at java.base/sun.nio.ch.NioSocketImpl.implRead(NioSock
etImpl.java:304)
        at java.base/sun.nio.ch.NioSocketImpl.read(NioSocketIm
pl.java:346)
        at java.base/sun.nio.ch.NioSocketImpl$1.read(NioSocket
Impl.java:796)
        at java.base/java.net.Socket$SocketInputStream.read(So
cket.java:1109)
        at java.base/java.io.BufferedInputStream.fill(Buffered
InputStream.java:291)
        at java.base/java.io.BufferedInputStream.read1(Buffere
dInputStream.java:347)
        at java.base/java.io.BufferedInputStream.implRead(Buff
eredInputStream.java:420)
        at java.base/java.io.BufferedInputStream.read(Buffered
InputStream.java:399)
        at java.base/java.io.DataInputStream.readFully(DataInp
utStream.java:208)
        at java.base/java.io.DataInputStream.readInt(DataInput
Stream.java:385)
        at java.rmi/sun.rmi.transport.tcp.TCPTransport$Connect
ionHandler.run0(TCPTransport.java:760)
        at java.rmi/sun.rmi.transport.tcp.TCPTransport$Connect
ionHandler.lambda$run$0(TCPTransport.java:721)
        at java.rmi/sun.rmi.transport.tcp.TCPTransport$Connect
ionHandler$$Lambda/0x000000011f510240.run(Unknown Source)
        at java.base/java.security.AccessController.executePri
vileged(AccessController.java:778)
        at java.base/java.security.AccessController.doPrivileg
ed(AccessController.java:400)
        at java.rmi/sun.rmi.transport.tcp.TCPTransport$Connect
ionHandler.run(TCPTransport.java:720)
        at java.base/java.util.concurrent.ThreadPoolExecutor.r
unWorker(ThreadPoolExecutor.java:1144)
        at java.base/java.util.concurrent.ThreadPoolExecutor$W
orker.run(ThreadPoolExecutor.java:642)
        at java.base/java.lang.Thread.runWith(Thread.java:1596
)
        at java.base/java.lang.Thread.run(Thread.java:1583)
java.lang.OutOfMemoryError: Java heap space
  at scala.collection.immutable.List.prependedAll(List.scala:1
56)
  at scala.collection.immutable.List$.from(List.scala:685)
  at scala.collection.immutable.List$.from(List.scala:682)
  at scala.collection.IterableFactory.range(Factory.scala:132)
  at scala.collection.IterableFactory.range$(Factory.scala:132
)
  at scala.collection.immutable.List$.range(List.scala:682)
  ... 26 elided

scala>   numbers.compile.toList


Exception: java.lang.OutOfMemoryError thrown from the Uncaught
ExceptionHandler in thread "RMI TCP Connection(idle)"
Exception in thread "RMI TCP Connection(idle)" java.lang.OutOf
MemoryError: Java heap space
java.lang.OutOfMemoryError: Java heap space

scala>






scala> exit
-- [E006] Not Found Error: -----------------------------------
------------------
1 |exit
  |^^^^
  |Not found: exit - did you mean Unit? or perhaps text or wai
t?
  |
  | longer explanation available when compiling with `-explain
`
1 error found


scala> exi
-- [E006] Not Found Error: -----------------------------------
------------------
1 |exi
  |^^^
  |Not found: exi
  |
  | longer explanation available when compiling with `-explain
`
1 error found


scala> quit
-- [E006] Not Found Error: -----------------------------------
------------------
1 |quit
  |^^^^
  |Not found: quit - did you mean Unit? or perhaps wait?
  |
  | longer explanation available when compiling with `-explain
`
1 error found


scala> :q
λ> tmux capture-pane -pS -1000000 > part-1.log

